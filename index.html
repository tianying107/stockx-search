<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockX Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Validation Page -->
    <div id="validation-page" class="bg-white p-8 rounded-2xl shadow-xl max-w-sm w-full text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Access Restricted</h1>
        <p class="text-gray-600 mb-6">
            Enter password to start.
        </p>
        <div class="mb-4">
            <input type="password" id="password-input" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter password">
        </div>
        <button id="login-button" class="bg-indigo-600 text-white font-medium py-3 px-6 rounded-xl shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105">
            Log In
        </button>
        <p id="validation-message" class="text-xs text-red-500 mt-2 hidden">Invalid password. Please try again.</p>
    </div>

    <!-- Main Application -->
    <div id="main-app" class="hidden">
        <div id="auth-container" class="bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">StockX Tool</h1>
            <p class="text-gray-600 mb-6">
                Connect your StockX account to get started.
            </p>
            
            <!-- Step 1: Link to StockX -->
            <div id="step-one" class="mb-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-2">1. Connect StockX</h2>
                <p class="text-sm text-gray-500 mb-4">
                    Log in and authorize the app to continue.
                </p>
                <button id="auth-button" class="bg-indigo-600 text-white font-medium py-3 px-6 rounded-xl shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105">
                    Connect
                </button>
            </div>

            <!-- Step 2: Display Authorization Code -->
            <div id="step-two" class="hidden mb-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-2">2. Get Code</h2>
                <p class="text-sm text-gray-500 mb-4">
                    Your code is ready. Use it to get your token.
                </p>
                <textarea id="code-display" readonly class="w-full h-24 p-3 font-mono text-sm bg-gray-50 rounded-lg border border-gray-300 resize-none overflow-auto shadow-inner"></textarea>
                <button id="copy-code-button" class="bg-green-500 text-white font-medium py-2 px-4 rounded-xl shadow-lg mt-4 hover:bg-green-600 transition duration-300">
                    Copy
                </button>
                <button id="use-code-button" class="bg-indigo-600 text-white font-medium py-2 px-4 rounded-xl shadow-lg mt-4 hover:bg-indigo-700 transition duration-300 ml-4">
                    Continue
                </button>
                <p id="copy-code-message" class="text-xs text-green-600 mt-2 opacity-0 transition-opacity duration-300">Copied!</p>
            </div>

            <!-- Step 3: Get Access Token -->
            <div id="step-three" class="hidden mb-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-2">3. Get Token</h2>
                <p class="text-sm text-gray-500 mb-4">
                    Click to get your access token.
                </p>
                <button id="get-token-button" class="bg-blue-600 text-white font-medium py-3 px-6 rounded-xl shadow-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105">
                    Get Token
                </button>
                <div id="token-display" class="hidden mt-6 text-left">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-700">Access Token</h3>
                        <textarea id="access-token-display" readonly class="w-full h-24 p-3 font-mono text-sm bg-gray-50 rounded-lg border border-gray-300 resize-none overflow-auto shadow-inner mt-2"></textarea>
                        <button id="copy-access-token-button" class="bg-green-500 text-white font-medium py-2 px-4 rounded-xl shadow-lg mt-2 hover:bg-green-600 transition duration-300">
                            Copy
                        </button>
                    </div>
                </div>
                <button id="proceed-to-step-4-button" class="bg-gray-400 text-white font-medium py-2 px-4 rounded-xl shadow-lg mt-4 hover:bg-gray-500 transition duration-300 transform hover:scale-105">
                    Proceed
                </button>
            </div>

            <!-- Step 4: Product Search and Selection -->
            <div id="product-search-section" class="hidden mt-8 bg-gray-50 p-6 rounded-2xl shadow-inner">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">4. Search & Analyze</h2>
                
                <!-- Financial Inputs -->
                <div id="financial-inputs-section" class="mt-6 mb-6 text-left bg-gray-100 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Your Costs</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div>
                            <label for="original-price-input" class="block text-gray-700 text-sm mb-1">Original Price ($)</label>
                            <input type="number" id="original-price-input" class="w-full p-2 border border-gray-300 rounded-lg" value="0">
                        </div>
                        <div>
                            <label for="discount-rate-input" class="block text-gray-700 text-sm mb-1">Discount (%)</label>
                            <input type="number" id="discount-rate-input" class="w-full p-2 border border-gray-300 rounded-lg" value="0">
                        </div>
                        <div>
                            <label for="tax-rate-input" class="block text-gray-700 text-sm mb-1">Tax (%)</label>
                            <input type="number" id="tax-rate-input" class="w-full p-2 border border-gray-300 rounded-lg" value="0">
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="product-query" class="block text-gray-700 font-medium text-left mb-1">Search:</label>
                    <input type="text" id="product-query" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Yeezy or IH5706">
                </div>
                <button id="search-button" class="bg-indigo-600 text-white font-medium py-2 px-4 rounded-xl shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105">
                    Search
                </button>

                <!-- Product Selection Section -->
                <div id="product-list-section" class="hidden mt-6 text-left">
                    <label for="product-select" class="block text-gray-700 font-medium mb-1">Select Product:</label>
                    <select id="product-select" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4"></select>
                    <button id="select-product-button" class="bg-green-600 text-white font-medium py-2 px-4 rounded-xl shadow-lg hover:bg-green-700 transition duration-300">
                        Select
                    </button>
                </div>
                
                <!-- Variants Table Section -->
                <div id="variants-table-section" class="hidden mt-6 text-left">
                    <h3 class="text-lg font-bold text-gray-700 mb-2">Highest Bids</h3>
                    <div class="overflow-x-auto rounded-lg shadow">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-200">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tl-lg">Variant</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Highest Bid</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Earned</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Cost</th>
                                    <th class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tr-lg">Profit?</th>
                                </tr>
                            </thead>
                            <tbody id="bids-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Bids will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <button id="calculate-profit-button" class="hidden bg-purple-600 text-white font-medium py-2 px-4 rounded-xl shadow-lg mt-4 hover:bg-purple-700 transition duration-300 transform hover:scale-105">
                    Calculate Profit
                </button>

                <button id="back-to-search-button" class="hidden bg-gray-400 text-white font-medium py-2 px-4 rounded-xl shadow-lg mt-4 hover:bg-gray-500 transition duration-300">
                    Back
                </button>

            </div>

            <!-- Status & Message -->
            <div id="status-message" class="text-sm text-gray-400 mt-6"></div>
        </div>
    </div>

    <script>
        const CLIENT_ID = 'bIQrwMpNVs2dj2N5QmCx1TUJm8GdgnzL';
        const REDIRECT_URI = window.location.origin + window.location.pathname;
        const CLIENT_SECRET = '5pCGn0XR2xCa4K6shFZqW1M0n6peSSi5ztMzpL20_pK7AMXghNjUcaMvQegW0rZv';
        const API_KEY = 'Zi3jWkYRWx1wIQ8VEaOXh4piarIpjwXj3utuH7Ct';
        const CORS_PROXY = 'https://corsproxy.io/?';
        const HASHED_PASSWORD = '86cb35a822329fe1de40eb82a1791be1f66f8bd327446686bdd859a89e436853';

        let currentProductId = null;
        let allBidsData = [];

        const statusMessage = document.getElementById('status-message');
        const stepOne = document.getElementById('step-one');
        const stepTwo = document.getElementById('step-two');
        const stepThree = document.getElementById('step-three');
        const productSearchSection = document.getElementById('product-search-section');

        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        document.getElementById('auth-button').addEventListener('click', () => {
            const authUrl = `https://accounts.stockx.com/authorize?` +
                            `response_type=code&` +
                            `client_id=${CLIENT_ID}&` +
                            `redirect_uri=${REDIRECT_URI}&` +
                            `scope=offline_access%20openid&` +
                            `audience=gateway.stockx.com`;
            window.location.href = authUrl;
        });

        document.getElementById('copy-code-button').addEventListener('click', () => {
            const codeDisplay = document.getElementById('code-display');
            codeDisplay.select();
            document.execCommand('copy');
            const message = document.getElementById('copy-code-message');
            message.classList.add('opacity-100');
            setTimeout(() => {
                message.classList.remove('opacity-100');
            }, 2000);
        });

        document.getElementById('use-code-button').addEventListener('click', () => {
            stepThree.classList.remove('hidden');
            statusMessage.textContent = 'Code ready. Click to get your token.';
        });
        
        document.getElementById('proceed-to-step-4-button').addEventListener('click', () => {
            productSearchSection.classList.remove('hidden');
            statusMessage.textContent = 'Ready to search for bids.';
        });

        document.getElementById('copy-access-token-button').addEventListener('click', () => {
            const tokenDisplay = document.getElementById('access-token-display');
            tokenDisplay.select();
            document.execCommand('copy');
        });

        document.getElementById('get-token-button').addEventListener('click', () => {
            const authCode = document.getElementById('code-display').value;
            if (authCode && authCode !== 'Token not found.') {
                exchangeCodeForToken(authCode);
            } else {
                statusMessage.textContent = 'No code found. Try again.';
            }
        });
        
        document.getElementById('search-button').addEventListener('click', searchProduct);
        document.getElementById('product-select').addEventListener('change', () => {
            document.getElementById('variants-table-section').classList.add('hidden');
            document.getElementById('back-to-search-button').classList.add('hidden');
        });
        document.getElementById('select-product-button').addEventListener('click', () => {
            const selectedProductUUID = document.getElementById('product-select').value;
            currentProductId = selectedProductUUID;
            fetchAndDisplayAllBids(document.getElementById('access-token-display').value, currentProductId);
        });
        document.getElementById('back-to-search-button').addEventListener('click', () => {
            document.getElementById('product-list-section').classList.remove('hidden');
            document.getElementById('variants-table-section').classList.add('hidden');
            document.getElementById('back-to-search-button').classList.add('hidden');
            document.getElementById('calculate-profit-button').classList.add('hidden');
            statusMessage.textContent = 'Select a new product to view its bids.';
        });
        document.getElementById('calculate-profit-button').addEventListener('click', calculateProfit);

        async function exchangeCodeForToken(authCode) {
            statusMessage.textContent = 'Getting token...';
            try {
                const response = await fetch('https://accounts.stockx.com/oauth/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        grant_type: 'authorization_code',
                        client_id: CLIENT_ID,
                        client_secret: CLIENT_SECRET,
                        redirect_uri: REDIRECT_URI,
                        code: authCode
                    })
                });

                const data = await response.json();
                console.log('Token exchange response:', data);
                
                if (response.ok) {
                    const accessToken = data.access_token || 'Token not found.';
                    localStorage.setItem('stockx_access_token', accessToken);
                    
                    document.getElementById('access-token-display').value = accessToken;
                    
                    statusMessage.textContent = 'Token ready. You can now search.';
                    
                    document.getElementById('token-display').classList.remove('hidden');
                    document.getElementById('proceed-to-step-4-button').classList.remove('bg-gray-400', 'cursor-not-allowed');
                    document.getElementById('proceed-to-step-4-button').classList.add('bg-indigo-600');
                } else {
                    statusMessage.textContent = `Error: ${data.error_description || data.error}`;
                }
            } catch (error) {
                statusMessage.textContent = `An error occurred: ${error.message}`;
                console.error('Error fetching token:', error);
            }
        }
        
        async function searchProduct() {
            const accessToken = document.getElementById('access-token-display').value;
            const query = document.getElementById('product-query').value.trim();

            if (!accessToken || accessToken === 'Token not found.') {
                statusMessage.textContent = 'You need a token to search. Get it in step 3.';
                return;
            }

            if (!query) {
                statusMessage.textContent = 'Please enter a product or style ID.';
                return;
            }

            statusMessage.textContent = 'Searching...';
            try {
                const url = `${CORS_PROXY}https://api.stockx.com/v2/catalog/search?query=${encodeURIComponent(query)}`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'X-Api-Key': API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 401) {
                    localStorage.removeItem('stockx_access_token');
                    statusMessage.textContent = 'Session expired. Connect again to continue.';
                    resetUI();
                    return;
                }

                const data = await response.json();
                console.log('Search response:', data);

                if (response.ok && data.products && data.products.length > 0) {
                    const exactMatch = data.products.find(p => p.styleId && p.styleId.toUpperCase() === query.toUpperCase());
                    
                    if (exactMatch) {
                        statusMessage.textContent = 'Exact style ID found. Getting bids...';
                        document.getElementById('product-list-section').classList.add('hidden');
                        fetchAndDisplayAllBids(accessToken, exactMatch.productId);
                        return;
                    }

                    const productSelect = document.getElementById('product-select');
                    productSelect.innerHTML = '';
                    data.products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.productId;
                        option.textContent = `${product.title} (${product.styleId})`;
                        productSelect.appendChild(option);
                    });
                    document.getElementById('product-list-section').classList.remove('hidden');
                    document.getElementById('variants-table-section').classList.add('hidden');
                    document.getElementById('back-to-search-button').classList.add('hidden');
                    statusMessage.textContent = 'Found products. Pick one.';
                } else {
                    statusMessage.textContent = 'No products found.';
                    document.getElementById('product-list-section').classList.add('hidden');
                    document.getElementById('variants-table-section').classList.add('hidden');
                    document.getElementById('back-to-search-button').classList.add('hidden');
                }
            } catch (error) {
                statusMessage.textContent = `An error occurred during search: ${error.message}`;
                console.error('Search error:', error);
            }
        }

        async function fetchAndDisplayAllBids(accessToken, productId) {
            statusMessage.textContent = 'Getting bids...';
            document.getElementById('variants-table-section').classList.add('hidden');
            document.getElementById('back-to-search-button').classList.add('hidden');
            document.getElementById('calculate-profit-button').classList.add('hidden');
            document.getElementById('product-list-section').classList.add('hidden');
            allBidsData = [];

            try {
                const variantsUrl = `${CORS_PROXY}https://api.stockx.com/v2/catalog/products/${productId}/variants`;
                const variantsResponse = await fetch(variantsUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'X-Api-Key': API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                if (variantsResponse.status === 401) {
                    localStorage.removeItem('stockx_access_token');
                    statusMessage.textContent = 'Session expired. Connect again to continue.';
                    resetUI();
                    return;
                }

                const variants = await variantsResponse.json();
                
                if (!variants || variants.length === 0) {
                    statusMessage.textContent = 'No variants found for this product.';
                    return;
                }

                const marketDataPromises = variants.map(variant => {
                    const marketDataUrl = `${CORS_PROXY}https://api.stockx.com/v2/catalog/products/${productId}/variants/${variant.variantId}/market-data`;
                    return fetch(marketDataUrl, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'X-Api-Key': API_KEY,
                            'Content-Type': 'application/json'
                        }
                    }).then(response => response.json())
                      .then(marketData => {
                          if (marketData.highestBidAmount) {
                            return {
                                variantName: variant.variantValue,
                                highestBid: marketData.highestBidAmount,
                                currency: marketData.currencyCode || ''
                            };
                          }
                          return null;
                      })
                      .catch(error => {
                          console.error(`Error fetching market data for variant ${variant.variantId}:`, error);
                          return null;
                      });
                });

                allBidsData = (await Promise.all(marketDataPromises)).filter(bid => bid !== null);
                allBidsData.sort((a, b) => b.highestBid - a.highestBid);

                const tableBody = document.getElementById('bids-table-body');
                tableBody.innerHTML = '';
                
                if (allBidsData.length === 0) {
                    statusMessage.textContent = 'No highest bids found for any variant.';
                    document.getElementById('back-to-search-button').classList.remove('hidden');
                    return;
                }

                allBidsData.forEach((bid) => {
                    const row = document.createElement('tr');
                    row.classList.add('hover:bg-gray-50');

                    const variantCell = document.createElement('td');
                    variantCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                    variantCell.textContent = bid.variantName;

                    const highestBidCell = document.createElement('td');
                    highestBidCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                    highestBidCell.textContent = `$${bid.highestBid} ${bid.currency}`;
                    
                    const earnedCell = document.createElement('td');
                    earnedCell.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-gray-500');
                    earnedCell.textContent = '-';

                    const costCell = document.createElement('td');
                    costCell.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-gray-500');
                    costCell.textContent = '-';

                    const profileFlagCell = document.createElement('td');
                    profileFlagCell.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-center', 'text-gray-500');
                    profileFlagCell.textContent = '-';

                    row.appendChild(variantCell);
                    row.appendChild(highestBidCell);
                    row.appendChild(earnedCell);
                    row.appendChild(costCell);
                    row.appendChild(profileFlagCell);
                    tableBody.appendChild(row);
                });

                document.getElementById('variants-table-section').classList.remove('hidden');
                document.getElementById('calculate-profit-button').classList.remove('hidden');
                document.getElementById('back-to-search-button').classList.remove('hidden');
                statusMessage.textContent = 'Bids retrieved. Click to calculate profit.';
            } catch (error) {
                statusMessage.textContent = `An error occurred while getting bids: ${error.message}`;
                console.error('Error fetching bids:', error);
            }
        }

        function calculateProfit() {
            if (allBidsData.length === 0) {
                statusMessage.textContent = 'No bids to calculate. Please search for a product first.';
                return;
            }

            const taxRate = parseFloat(document.getElementById('tax-rate-input').value) / 100;
            const discountRate = parseFloat(document.getElementById('discount-rate-input').value) / 100;
            const originalPrice = parseFloat(document.getElementById('original-price-input').value);
            
            const processedBids = allBidsData.map(bid => {
                const highestBid = parseFloat(bid.highestBid);
                const earned = Math.min(highestBid * 0.89, highestBid - 5) - 4;
                const cost = originalPrice * (1 - discountRate) * (1 + taxRate);
                const makeProfileFlag = earned > cost;
                return {
                    ...bid,
                    earned: earned,
                    cost: cost,
                    makeProfileFlag: makeProfileFlag
                };
            });

            const tableBody = document.getElementById('bids-table-body');
            tableBody.innerHTML = '';

            processedBids.forEach((bid, index) => {
                const row = document.createElement('tr');
                const isHighest = index === 0;
                row.classList.add('hover:bg-gray-50');
                if (isHighest) {
                    row.classList.add('bg-green-100', 'font-semibold', 'text-green-800');
                }

                const variantCell = document.createElement('td');
                variantCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                variantCell.textContent = bid.variantName;

                const highestBidCell = document.createElement('td');
                highestBidCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                highestBidCell.textContent = `$${bid.highestBid} ${bid.currency}`;

                const earnedCell = document.createElement('td');
                earnedCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                earnedCell.textContent = `$${bid.earned.toFixed(2)}`;
                
                const costCell = document.createElement('td');
                costCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                costCell.textContent = `$${bid.cost.toFixed(2)}`;

                const profileFlagCell = document.createElement('td');
                profileFlagCell.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-center');
                profileFlagCell.textContent = bid.makeProfileFlag ? '✔' : '✖';
                profileFlagCell.classList.add(bid.makeProfileFlag ? 'text-green-600' : 'text-red-600', 'font-bold', 'text-lg');

                row.appendChild(variantCell);
                row.appendChild(highestBidCell);
                row.appendChild(earnedCell);
                row.appendChild(costCell);
                row.appendChild(profileFlagCell);
                tableBody.appendChild(row);
            });
            statusMessage.textContent = 'Done! Profit calculated.';
        }
        
        function resetUI() {
            stepOne.classList.remove('hidden');
            stepTwo.classList.add('hidden');
            stepThree.classList.add('hidden');
            productSearchSection.classList.add('hidden');
            document.getElementById('access-token-display').value = '';
        }

        async function checkAuth() {
            const validationPage = document.getElementById('validation-page');
            const mainApp = document.getElementById('main-app');
            const authorizedSession = localStorage.getItem('authorized_session');

            if (authorizedSession) {
                validationPage.classList.add('hidden');
                mainApp.classList.remove('hidden');
                
                const urlParams = new URLSearchParams(window.location.search);
                const authCode = urlParams.get('code');
                const storedToken = localStorage.getItem('stockx_access_token');
            
                if (authCode) {
                    stepOne.classList.add('hidden');
                    stepTwo.classList.remove('hidden');
                    document.getElementById('code-display').value = authCode;
                    statusMessage.textContent = 'Code ready. Click "Continue" to proceed.';
                } else if (storedToken) {
                    stepOne.classList.add('hidden');
                    stepTwo.classList.add('hidden');
                    stepThree.classList.add('hidden');
                    productSearchSection.classList.remove('hidden');
                    document.getElementById('access-token-display').value = storedToken;
                    statusMessage.textContent = 'Welcome back! Your previous session was restored.';
                } else {
                    statusMessage.textContent = 'Click the button to begin.';
                }

            } else {
                validationPage.classList.remove('hidden');
                mainApp.classList.add('hidden');
            }
        }

        window.onload = checkAuth;

        document.getElementById('login-button').addEventListener('click', async () => {
            const passwordInput = document.getElementById('password-input').value.trim();
            const validationMessage = document.getElementById('validation-message');
            
            const hashedAttempt = await hashPassword(passwordInput);

            if (hashedAttempt === HASHED_PASSWORD) {
                localStorage.setItem('authorized_session', 'true');
                validationMessage.classList.add('hidden');
                checkAuth();
            } else {
                validationMessage.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
